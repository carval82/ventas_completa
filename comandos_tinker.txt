// Comandos para ejecutar en php artisan tinker

// 1. Verificar empresa
$empresa = \App\Models\Empresa::first();
echo "Empresa: " . $empresa->nombre_comercial . "\n";
echo "Email Alegra: " . $empresa->alegra_email . "\n";
echo "MÃºltiples impuestos (antes): " . ($empresa->alegra_multiples_impuestos ? 'SÃ' : 'NO') . "\n";

// 2. Configurar empresa para NO usar mÃºltiples impuestos
$empresa->alegra_multiples_impuestos = false;
$empresa->save();
echo "âœ… Empresa configurada para NO usar mÃºltiples impuestos\n";

// 3. Verificar producto
$producto = \App\Models\Producto::find(43);
echo "Producto: " . $producto->nombre . "\n";
echo "CÃ³digo: " . $producto->codigo . "\n";
echo "IVA: " . $producto->iva . "%\n";
echo "ID Alegra actual: " . ($producto->id_alegra ?? 'NO SINCRONIZADO') . "\n";

// 4. Limpiar sincronizaciÃ³n anterior para forzar nueva creaciÃ³n
$producto->id_alegra = null;
$producto->save();
echo "âœ… ID Alegra limpiado\n";

// 5. Intentar sincronizar con la correcciÃ³n
echo "ðŸš€ Sincronizando con Alegra...\n";
$resultado = $producto->syncToAlegra();

// 6. Mostrar resultado
if ($resultado['success']) {
    echo "âœ… Ã‰XITO: Producto sincronizado correctamente\n";
    echo "ID Alegra: " . $resultado['id_alegra'] . "\n";
    echo "Mensaje: " . $resultado['message'] . "\n";
} else {
    echo "âŒ ERROR: " . $resultado['message'] . "\n";
    if (isset($resultado['error'])) {
        echo "Detalle: " . $resultado['error'] . "\n";
    }
}

// 7. Verificar que se guardÃ³
$producto->refresh();
echo "ID Alegra final: " . ($producto->id_alegra ?? 'NO GUARDADO') . "\n";

exit
